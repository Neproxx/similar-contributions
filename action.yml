name: 'similar-contributions'
description: 'Searches for similar contributions by comparing previous pull requests to the current proposal title'

inputs:
  search_dir:
    description: Directory containing the contributions
    required: true
    default: "attic"
  filter_type:
    description: Filter for contribution types that are should be regarded
    required: true
    default: "['essay', 'course-automation', 'demo', 'presentation', 'executable-tutorial', 'tutorial', 'open-source', 'open']"
  filter_year: 
    description: Filter for contribution years that should be regarded
    required: true
    default: "['2019', '2020', '2021']"
  min_word_similarity:
    description: Treshold for similiarity check of keywords
    required: true
    default: "0.8"
  extra_stopwords:
    description: Add extra stopwords, that are not regarded when comparing the proposal titles
    required: true
    default: "['testing', 'automated', 'pipeline', 'deployment', 'using']"
  sort_option:
    description: Specify sorting type for contributions
    required: true
    default: 'sort_by_keywords'
    type: choice
    options:
    - no_sorting
    - sort_by_keywords
runs:
  using: "composite"
  steps:
    - run: python -m pip install nltk  # Installing dependencies
      shell: bash
    - run: python ./main.py
      shell: bash
      env:
        INPUT_SEARCH_DIR: ${{ inputs.search_dir }}
        INPUT_FILTER_TYPE: ${{ inputs.filter_type }}
        INPUT_FILTER_YEAR: ${{ inputs.filter_year }}
        INPUT_MIN_WORD_SIMILARITY: ${{ inputs.min_word_similarity }}
        INPUT_EXTRA_STOPWORDS: ${{ inputs.extra_stopwords }}
        INPUT_SORT_OPTION: ${{ inputs.sort_option }}
      
    # Set env according to https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#multiline-strings
    - name: Read generated comment into env
      run: |
        echo 'GENERATED_COMMENT<<EOF' >> $GITHUB_ENV
        cat $GITHUB_WORKSPACE/generated_comment.md >> $GITHUB_ENV
        echo 'EOF' >> $GITHUB_ENV
      shell: bash
